extends layout

block scripts
    script: include ../public/javascripts/pool.js

block content
    div.row
        ul.breadcrumb
            li
                a(href='/') Pools 
                span.divider /
            li #{poolName} 

            include _loginMsg.jade

    div.row: div.content
        div.c2
            p
                a(href='#filters' id='filtersMenuToggle')
                    strong - 
                    | Filters
        div#filtersMenu.c6
            form.hform(action='/pool/#{_poolId}' method='GET')
                fieldset
                    label Instructor Last Name
                    span.pre(style='width: 71px') contains
                    input.pre(style='width: 169px' type='text' name='instructorLastName'
                            placeholder='<String>' value=(query.instructorLastName || ''))
                fieldset
                    label Unique
                    span.pre(style='width: 30px') =
                    input.pre(style='width: 210px' type='text' name='unique'
                            placeholder='<Number>' value=(query.unique || ''))
                fieldset
                    label Status
                    select(name='status' style='width: 240px')
                        option(value='' selected=!query.status)
                        each val, key in statusPaths
                            option(value='#{key}' selected=(query.status === key))
                                | #{val.text}
                button(type='submit') Update

    div.row: div.content
        table#subjectTable.tablesorter
          thead
            tr
                mixin filterText(rel, str)
                    if str
                        br/
                        em: i
                            | (#{rel} 
                            strong #{str})

                th Subject Name
                th ID
                th E-Mail
                th
                    | Instructor Name
                    +filterText('contains', query.instructorLastName)
                th Course
                th
                    | Unique
                    +filterText('equals', query.unique)
                th File
                th
                    | Status
                    if query.status
                        +filterText('equals', statusPaths[query.status].text)
                th Credits Earned
                th
          tbody
            each s, i in subjects

                tr
                    td.cutoff #{s.lastName}, #{s.firstName}
                    td.text-right.cutoff #{s.utId}
                    td.cutoff: a(href='mailto:#{s.email}') #{s.email}
                    td.cutoff #{s.instructor.lastName}, #{s.instructor.firstName}
                    td.text-left.cutoff(title='#{s.courseId}') #{s.courseId}
                    td.text-right.cutoff #{s.uniqueId}
                    td.text-center
                        span.file-view-reimport(style=s.file.originalName ? '' : 'display: none')
                            a.view-link.tooltip(
                                    href='/subject/#{s._id}/view-file'
                                    title='#{s.file.originalName}'
                                    target='_blank') View 
                            | | 
                            a.file-import-link(href='#') Reimport
                        span.file-import(style=s.file.originalName ? 'display: none' : '')
                            a.file-import-link(href='#') Import
                        span.file-uploading(style='display: none')
                            | Uploading...

                        form.vform(action='/subject/#{s._id}/update' method='POST' enctype='multipart/form-data')
                            input(type='file' name='doc file input' style='display: none' accept='.docx')/

                    td
                        form.vform(action='/subject/#{s._id}/update' method='POST' enctype='multipart/form-data')
                            select(name='status')
                                option(value='#{s.status}' selected) [#{s.status}]
                    td.text-right #{s.creditsEarned}
                    td.text-center
                        a.remove-link(href='/subject/#{s._id}/remove') x

    div.row: div.content
        div.c2
            p
                a(href='/pool/#{_poolId}/add-subject')
                    strong + 
                    | Add subject
                br/
                a.list-import-link(href='/pool/#{_poolId}/import-subjects')
                    strong + 
                    | Import subject list
                //- form(action='/pool/#{_poolId}/import-subjects' method='POST'
                //-         enctype='multipart/form-data' style='display: none')
                //-     input(type='file' name='list file input' id='listFileInput' style='display: none')

